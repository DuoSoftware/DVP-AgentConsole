/** * Created by Damith on 1/18/2017. */agentApp.directive('chatTabDirective', function ($rootScope, chatService) {    return {        restrict: "EA",        scope: {            chatUser: "=",            selectedChatUser: "=",            loginName: "=",            loginAvatar: "="        },        templateUrl: 'app/views/chat/chat-view.html',        link: function (scope, ele, attr) {            scope.chatTxt = null;            scope.chatUser.chatcount = 0;            chatService.SubscribeChat(scope.chatUser.username, function (type, message) {                switch (type) {                    case 'message':                        scope.messageThread.push(message);                        console.log(scope.messageThread);                        break;                    case 'typing':                        scope.chatUser.typing = true;                        break;                    case 'typingstoped':                        scope.chatUser.typing = false;                        break;                    case 'latestmessages':                        console.log('latestmessages', message);                        scope.messageThread = [];                        message.messages.forEach(function (message) {                            message.message = message.data;                            scope.messageThread.push(message);                        });                        break;                }            });            chatService.Request('latestmessages', scope.chatUser.username);            scope.messageThread = [];            //user on type            scope.onFocusChat = function (val) {                SE.typing({to: scope.chatUser.username, from: scope.loginName});            };            scope.onFocusOutChat = function (val) {                SE.typingstoped({to: scope.chatUser.username, from: scope.loginName});            };            scope.sendMessage = function (user, msg) {                if (user) {                    var message = {'to': user.username, 'message': msg, 'type': "text"};                    SE.sendmessage(message);                    scope.messageThread.push(message);                    console.log(scope.messageThread);                }            };            // //UI function            scope.position = function () {                scope.rightPosotion = 18 + "%";                if (scope.selectedChatUser.length == 1) {                    scope.rightPosotion = 18 + "%";                } else {                    scope.rightPosotion = 18 + 20 + "%";                }            };        }    }});